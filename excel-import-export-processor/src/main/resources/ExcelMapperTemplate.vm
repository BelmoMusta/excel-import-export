package $wrapper.aPackage;

import $wrapper.className;
import io.github.belmomusta.excel.api.export.AbstractExcelMapper;
import io.github.belmomusta.excel.api.exception.ExcelExporterException;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;

import java.util.Collection;
import java.io.File;

public class ${wrapper.simplifiedClassName}ExcelMapper extends AbstractExcelMapper<$wrapper.simplifiedClassName> {

    @Override
    public void exportToFile(Collection<? extends $wrapper.simplifiedClassName> $wrapper.paramName, File destFile) throws ExcelExporterException{
        try (XSSFWorkbook workbook = new XSSFWorkbook()) {
            final Sheet sheet = workbook.createSheet("${wrapper.simplifiedClassName}");
            writeHeaders(sheet);
            for ($wrapper.simplifiedClassName data : ${wrapper.paramName}) {
                createRows(sheet, data);
            }
            writeWorkbookToFile(workbook, destFile);
        } catch (Exception e) {
            throw new ExcelExporterException("Error while exporting " + ${wrapper.simplifiedClassName}.class.getName(), e);
        }
    }

#if($wrapper.withHeaders)
    @Override
    protected void writeHeaders(Sheet sheet) {
        final Row header = sheet.createRow(0);
#foreach($header in $wrapper.correspondanceFieldMethod)
#if($header.ordered)
        addCellWithValue(header, $header.order, "${header.name}");
#else
        addCellWithValue(header, "${header.name}");
#end
#end
    }
#end

    private void createRows(Sheet sheet, $wrapper.simplifiedClassName data) {
        final Row row = sheet.createRow(sheet.getLastRowNum() + 1);
#foreach($pair in $wrapper.correspondanceFieldMethod)
#if($pair.ordered)
        addCellWithValue(row, $pair.order, valueOf(data.${pair.method}()));
#else
        addCellWithValue(row, valueOf(data.${pair.method}()));
#end
#end
    }
}
